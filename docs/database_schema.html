<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AegisVault Database Schema</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 1.5rem; }
    .container { max-width: 1100px; margin: 0 auto; }
    h1 { font-size: 1.75rem; margin-bottom: 0.5rem; text-align: center; }
    p.note { color: #444; margin-top: 0; text-align: center; }
    .mermaid { margin: 2rem auto 1rem; }
    .legend { display: flex; justify-content: center; margin-top: 8px; }
    .legend-card { border: 2px solid #64748b; border-radius: 8px; padding: 8px 12px; background: #ffffff; box-shadow: 0 1px 2px rgba(0,0,0,0.08); }
    .legend-title { font-weight: 600; font-size: 0.95rem; margin: 0 0 6px 0; text-align: center; color: #111827; }
    .legend-list { list-style: none; padding: 0; margin: 0; display: grid; grid-template-columns: 1fr 1fr; gap: 6px 16px; }
    .legend-item { font-size: 0.9rem; color: #111827; }
    .meta { margin-top: 16px; color: #374151; font-size: 0.9rem; }
    .meta code { background: #f3f4f6; padding: 0 4px; border-radius: 4px; }
  </style>
  <script type="module">
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
    mermaid.initialize({ startOnLoad: true, theme: "default" });
  </script>
</head>
<body>
  <div class="container">
    <h1>AegisVault — Database Schema</h1>
    <p class="note">Entity–relationship view of tables in <code>data/passwords.db</code> and how they relate.</p>

    <div class="mermaid">
erDiagram
  MASTER_ACCOUNT {
    string username
    string password
  }
  USER_PREFERENCES {
    string username
    int session_timeout
    boolean lock_on_tab_inactive
    boolean lock_on_suspicious_activity
    boolean auto_lock_enabled
    boolean lock_on_window_blur
    datetime created_at
    datetime updated_at
  }
  CREDENTIALS {
    int id
    string website
    string username
    string password
    datetime created_at
    datetime updated_at
    datetime deleted_at
  }
  AUDIT_LOGS {
    int id
    string username
    string action_type
    string action_description
    string target_resource
    string ip_address
    string user_agent
    boolean success
    string error_message
    string session_id
    string additional_data
    datetime created_at
  }

  MASTER_ACCOUNT ||--|| USER_PREFERENCES : has
  MASTER_ACCOUNT ||--o{ CREDENTIALS : manages
  MASTER_ACCOUNT ||--o{ AUDIT_LOGS : produces
  USER_PREFERENCES ||--|| MASTER_ACCOUNT : belongs_to
    </div>

    <div class="legend">
      <div class="legend-card" aria-label="Legend">
        <p class="legend-title">Legend</p>
        <ul class="legend-list">
          <li class="legend-item"><strong>PK</strong>: Primary key</li>
          <li class="legend-item"><strong>FK</strong>: Foreign key (logical)</li>
          <li class="legend-item"><strong>UNIQUE</strong>: Unique constraint</li>
          <li class="legend-item"><strong>ENC</strong>: Encrypted at rest</li>
          <li class="legend-item"><strong>NULL</strong>: Nullable field</li>
        </ul>
      </div>
    </div>

    <div class="meta">
      Indexes used in the schema: <code>idx_credentials_website</code>, <code>idx_credentials_deleted_at</code>, <code>idx_credentials_website_active</code>, <code>idx_audit_logs_*</code> for filtering and recency. Relationships are logical; SQLite schema does not declare foreign keys in code.
    </div>

  </div>
</body>
</html>
